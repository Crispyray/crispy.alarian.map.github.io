<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Testing Carte H&D Alarian</title>
    <link rel="icon" href="./favicon.ico" type="image/x-icon">

    <!-- Inclure les fichier SVG depuis le dossier "svg" -->
    <object data="./svg/alarian-Ystaad.svg" type="image/svg+xml" id="zoneSVG"></object>

    
    <!-- Inclure les styles -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet-draw@1.0.4/dist/leaflet.draw.css" />
    <!-- Inclure Leaflet et Leaflet Draw -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    <script src="https://unpkg.com/leaflet-draw@1.0.4/dist/leaflet.draw.js"></script>
    <!-- Inclure Leaflet-SVG -->
    <script src="https://unpkg.com/leaflet-svg@0.2.1/dist/leaflet-svg.js"></script>
    <script src="https://unpkg.com/leaflet-svg-overlay"></script>


    <style>
        #map {
            width: 95%;
            height: 90vh;
            margin: 0 auto;
        }
        #coordinates {
            position: absolute;
            bottom: 10px;
            left: 10px;
            background-color: white;
            padding: 5px;
            border: 1px solid #ccc;
            box-shadow: 0 0 5px #888;
            z-index: 1000
        }
        #length-display {
            position: absolute;
            bottom: 10px; /* Ajustez la position verticale selon vos besoins */
            right: 40px; /* Ajustez la position horizontale selon vos besoins */
            background-color: white;
            padding: 5px;
            border: 1px solid #ccc;
            box-shadow: 0 0 5px #888;
            z-index: 1000; /* Assurez-vous que l'élément est au-dessus de la carte */
        }
        .leaflet-draw-draw-polyline path {
            stroke: red;
            stroke-width: 4px;
            stroke-linejoin: round;
        }
    </style>
</head>
<body>
    <div id="length-display">Distance : </div>
    <div id="coordinates">Coordonnées : </div>
    <div id="map-container">
        <div id="map"></div>
    </div>

    <script>
        var youAreHere = [3.851,-2.7015];
        var imagePaths = {
            talbethHav: './images/Entetes-TalbethHav.jpg',
            qereanHav: './images/Entetes-QereanHav.jpg',
            candelle: './images/Entetes-Candelle.jpg',
            kelgen: './images/Entetes-Kelgen.jpg',
            foretYfondh: './images/Entetes-ForetYfondh.jpg',
            youAreHerePath: './images/Entetes-VousEtesIci.jpg',
            // Ajoutez d'autres chemins d'images ici...
        };
        var cityIcon = L.icon({
            iconUrl: './images/IcoVille.png',
            iconSize: [60, 40],
            iconAnchor: [18, 40],
            popupAnchor: [0, -45]
        });

        // Créer une icône pour les lieux-dits
        var landmarkIcon = L.icon({
            iconUrl: './images/IcoEye.png',
            iconSize: [28, 16],
            iconAnchor: [14, 8],
            popupAnchor: [0, -16]
        });
        var hdIcon = L.icon({
            iconUrl: './images/IcoHetD.png',
            iconSize: [64, 64],
            iconAnchor: [0, 64],
            popupAnchor: [0, 0]
        });
        var cities = [
            {
                name: "Talbeth-Hav",
                latlng: [1.864, -1.967],
                description: '<img src="' + imagePaths.talbethHav + '"><br>Chef-lieu de l’Ystaad, Talbeth-Hav est aussi la capitale du royaume d’Alarian. Ses habitants sont appelés les Talbethiens et Talbethiennes.'
             },
            {
                name: "Qerean-Hav",
                latlng: [3.87, -2.712],
                description: '<img src="' + imagePaths.qereanHav + '"> <br>Aventure : \"La Nef des Ombres\".'
           
            },
            {
                name: "Kelgen",
                latlng: [2.922, -1.983],
                description: '<img src="' + imagePaths.kelgen + '"> <br>Kelgen est une petite ville ou un grand village. Pittoresque, avec sa place du marché et ses quelques auberges réputées (dont celle du \"Faisant Doré\"), ces parcs et allentours verdurés/verdoyants...<br> c\'est tout naturellement que nos aventuriers y ont élu domicile <br><br> Aventure : \"Le Miroir Brisé\".'
           
            }
            // Ajoutez d'autres villes ici...
        ];

        var landmarks = [
            {
                name: "Forêt d'Yfondh",
                latlng: [3.505, -2.707],
                description: '<img src="' + imagePaths.foretYfondh + '"><br>La forêt d\'Yfondh est une forêt assez dense réputée pour être la zone où les guildes de marrauds et de brigants se réfugient une fois leurs méfaits accomplis.<br> Nos compagons ont dernièrement apperçu y pénétrer une armée composée de différents groupes armés provenant de multiples régions (dont la milice de Talbeth-Hav).'
           
            },
            {
                name: "La Candelle",
                latlng: [3.867, -2.605],
                description: '<img src="' + imagePaths.candelle + '"><br>Aventure : \"La Nef des Ombres\".<br>La candelle est un pic rocheux à flanc de falaise, son accès est difficile car dans l\'estuaire la mer est mauvaise, peu connaissent son existance.'
          
            }
            // Ajoutez d'autres lieux-dits ici...
        ];
        var posHeros = [
            {
                name: "Vous êtes ici!",
                latlng: youAreHere,
                description: '<img src="' + imagePaths.youAreHerePath + '">'
           
            }
            // Ajoutez d'autres lieux-dits ici...
        ];
        var provinces = [
            {
                svgData: '...', // Remplacez par le code SVG de la première province
                bounds: [[lat1, lon1], [lat2, lon2]], // Remplacez par les limites de la première province
            },
            {
                svgData: '...', // Remplacez par le code SVG de la deuxième province
                bounds: [[lat1, lon1], [lat2, lon2]], // Remplacez par les limites de la deuxième province
            },
            // Ajoutez d'autres provinces ici...
        ];


        var citiesGroup = L.layerGroup();
        var landmarksGroup = L.layerGroup();
        var youAreHereGroup = L.layerGroup();
        var provincesLayer = L.layerGroup();


        var imageUrl = './images/alarian.jpg';
        var imageBounds = [[-8.7, -6], [8.7, 6]];
      

        var map = L.map('map', {
            zoomSnap: 0.25,
            zoomDelta: 0.51,
            wheelPxPerZoomLevel: 600,
            center: youAreHere,
            layers: [citiesGroup, landmarksGroup],
            //measureControl: true
        });
        var image = L.imageOverlay(imageUrl, imageBounds).addTo(map);
        L.control.scale({ imperial: false }).addTo(map);

        var coordinatesDiv = document.getElementById('coordinates');
            map.on('mousemove', function(event) {
            var lat = event.latlng.lat.toFixed(6);
            var lng = event.latlng.lng.toFixed(6);
            coordinatesDiv.innerHTML = 'Coordonnées : ' + lat + ', ' + lng;
        });

        function addPointsOfInterestToGroup(points, group, icon) {
            points.forEach(function(point) {
                var marker = L.marker(point.latlng, { icon: icon });
                marker.bindTooltip(point.name).openTooltip();
                marker.bindPopup(point.description, { minWidth: 376, maxWidth: 376 });
                marker.addTo(group);
            });
        }

        addPointsOfInterestToGroup(cities, citiesGroup,cityIcon);
        addPointsOfInterestToGroup(landmarks, landmarksGroup,landmarkIcon);
        addPointsOfInterestToGroup(posHeros, youAreHereGroup,hdIcon);
       
        map.fitBounds(imageBounds);
        image.addTo(map);
        map.setZoom(7.25);
        
        L.control.layers({}, {
            "Villes": citiesGroup,
            "Point d'Intétêts": landmarksGroup,
            "Vous êtes ici": youAreHereGroup,
            "Provinces" : provincesLayer
        }).addTo(map);
        
        
            youAreHereGroup.addTo(map);

            // Pour la désactiver
            landmarksGroup.removeFrom(map);
                

////////// le nouveau ////////////
        var drawnItems = new L.FeatureGroup();
        map.addLayer(drawnItems);

        var drawControl = new L.Control.Draw({
            edit: {
                featureGroup: drawnItems,
            },
            draw: {
                polygon: false,
                polyline: true,
                circle: false,
                marker: true,
                rectangle: false,
            },
        });
var drawControl = new L.Control.Draw({
    edit: {
        featureGroup: drawnItems,
    },
    draw: {
        polygon: false,
        polyline: {
            shapeOptions: {
                color: 'red', // Couleur de la ligne (par exemple, bleue)
                weight: 4,     // Épaisseur de la ligne (par exemple, 3 pixels)
                lineCap: 'round'
            },
            allowIntersection: true,
            drawError: {
                color: 'orange',
                timeout: 1000,
            },
            showLength: true,
        },
        circle: false,
        marker: true,
        rectangle: {
            shapeOptions: {
                color: 'green', // Couleur du rectangle (par exemple, verte)
                weight: 2,      // Épaisseur du rectangle (par exemple, 2 pixels)
            },
        },
    },
});
        map.addControl(drawControl);

        map.on('draw:created', function (e) {
            var type = e.layerType;
            var layer = e.layer;

            if (type === 'marker' || type === 'rectangle') {
                // Ajoutez votre logique de mesure ici pour les marqueurs ou les rectangles
            }

            drawnItems.addLayer(layer);
            
map.on('draw:created', function (e) {
    var type = e.layerType;
    var layer = e.layer;

    if (type === 'polyline') {
        var latlngs = layer.getLatLngs();
        var length = 0;

        for (var i = 1; i < latlngs.length; i++) {
            length += latlngs[i - 1].distanceTo(latlngs[i]);
        }

        // Affichez la longueur calculée dans la div que vous avez créée
        var lengthDisplay = document.getElementById('length-display');
        lengthDisplay.textContent = 'Distance : ' + length.toFixed(2) + ' mètres';
    }

    drawnItems.addLayer(layer);
});
map.on('draw:edited', function (e) {
    var editedLayers = e.layers;

    editedLayers.eachLayer(function (layer) {
        if (layer instanceof L.Polyline) {
            var latlngs = layer.getLatLngs();
            var length = 0;

            for (var i = 1; i < latlngs.length; i++) {
                length += latlngs[i - 1].distanceTo(latlngs[i]);
            }

            // Mettez à jour la distance dans l'élément HTML où vous affichez la distance
            document.getElementById('distanceDisplay').innerHTML = 'Distance : ' + length + ' mètres';
        }
    });
});


//////////////////////////////////////////////
        });

    </script>
</body>
</html>
